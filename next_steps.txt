Step 1️⃣: Prerequisites

Before using Snowpipe, make sure you have:

Warehouse created (e.g., bronze_wh)

Database and schema created (e.g., ecommerce_db.raw)

Tables in Bronze (customers, products, sales)

S3 bucket with files in a folder, e.g., s3://your-bucket-name/bronze/

Storage Integration in Snowflake to securely access S3 without embedding AWS keys

Step 2️⃣: Create a File Format

Snowflake needs to know the format of your files:

-- CSV file format for your data
CREATE OR REPLACE FILE FORMAT csv_format
TYPE = 'CSV'
FIELD_OPTIONALLY_ENCLOSED_BY='"'
SKIP_HEADER = 1;


SKIP_HEADER = 1 ignores the first row (header)

FIELD_OPTIONALLY_ENCLOSED_BY='"' handles quotes in strings

Step 3️⃣: Create Snowpipe for Each Table

Snowpipe is a continuous ingestion service that loads data from S3 to Snowflake automatically.

Customers Table
CREATE OR REPLACE PIPE customers_pipe
AUTO_INGEST = TRUE
AS
COPY INTO ecommerce_db.raw.customers
FROM @bronze_stage/customers.csv
FILE_FORMAT = (FORMAT_NAME = csv_format);

Products Table
CREATE OR REPLACE PIPE products_pipe
AUTO_INGEST = TRUE
AS
COPY INTO ecommerce_db.raw.products
FROM @bronze_stage/products.csv
FILE_FORMAT = (FORMAT_NAME = csv_format);

Sales Table
CREATE OR REPLACE PIPE sales_pipe
AUTO_INGEST = TRUE
AS
COPY INTO ecommerce_db.raw.sales
FROM @bronze_stage/sales.csv
FILE_FORMAT = (FORMAT_NAME = csv_format);


Notes:

AUTO_INGEST = TRUE → Snowpipe will automatically load new files from S3 using event notifications

@bronze_stage/customers.csv → path to your file in the stage

You can upload multiple files to S3; Snowpipe will process them automatically.

Step 4️⃣: Configure S3 Event Notifications (for auto-ingest)

For AUTO_INGEST to work:

Go to your S3 bucket → Properties → Event notifications

Create a notification for PUT events in the bronze/ folder

Link it to an SNS topic

Snowflake’s storage integration must have permission to subscribe to this SNS topic

If you don’t want auto-ingest yet, you can manually trigger Snowpipe using:

-- Manually trigger the pipe
ALTER PIPE customers_pipe REFRESH;
ALTER PIPE products_pipe REFRESH;
ALTER PIPE sales_pipe REFRESH;

Step 5️⃣: Check Load History

To verify files were loaded:

-- Check load history for customers
SELECT *
FROM table(information_schema.load_history(table_name=>'CUSTOMERS'));


Shows file name, load time, rows loaded, and errors if any

✅ Summary

Create CSV file format

Create Snowpipe for each table (customers, products, sales)

Configure S3 notifications for auto-ingest (optional)

Verify data loaded into Bronze tables